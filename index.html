<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOX STELLARUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { cinzel: ['Cinzel', 'serif'], serif: ['Lora', 'serif'] },
                    animation: { 
                        'fade-in': 'fadeIn 1s ease-out forwards', 
                        'zoom-in': 'zoomIn 0.5s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        zoomIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-15px)' } }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base { 
            body { @apply bg-[#020617] text-amber-50 min-h-screen overflow-x-hidden; } 
        }
        .tarot-deck-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 0.5rem; 
        }
        @media (min-width: 640px) { .tarot-deck-grid { grid-template-columns: repeat(8, 1fr); gap: 0.75rem; } }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –∫–Ω–æ–ø–æ–∫ */
        .glow-text { text-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        .shadow-glow { box-shadow: 0 0 30px rgba(245, 158, 11, 0.15); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const TAROT_DECK = [
            { name: "Fool", emoji: "üÉè" }, { name: "Magician", emoji: "ü™Ñ" }, { name: "Priestess", emoji: "üåô" },
            { name: "Empress", emoji: "üåø" }, { name: "Emperor", emoji: "üëë" }, { name: "Hierophant", emoji: "‚õ™" },
            { name: "Lovers", emoji: "‚ù§Ô∏è" }, { name: "Chariot", emoji: "‚öîÔ∏è" }, { name: "Strength", emoji: "ü¶Å" },
            { name: "Hermit", emoji: "üèÆ" }, { name: "Wheel", emoji: "üé°" }, { name: "Justice", emoji: "‚öñÔ∏è" },
            { name: "Hanged", emoji: "‚è≥" }, { name: "Death", emoji: "üíÄ" }, { name: "Temperance", emoji: "üç∑" },
            { name: "Devil", emoji: "üòà" }, { name: "Tower", emoji: "‚ö°" }, { name: "Star", emoji: "‚≠ê" },
            { name: "Moon", emoji: "üåï" }, { name: "Sun", emoji: "‚òÄÔ∏è" }, { name: "Judgement", emoji: "üé∫" }, { name: "World", emoji: "üåç" }
        ];

        function App() {
            const [step, setStep] = useState('welcome');
            const [selectedCards, setSelectedCards] = useState([]);
            const [reading, setReading] = useState("");
            const [loading, setLoading] = useState(false);
            const [question, setQuestion] = useState("");

            const drawCard = (card) => {
                if (selectedCards.length < 3 && !selectedCards.some(c => c.name === card.name)) {
                    setSelectedCards(prev => [...prev, card]);
                }
            };

            const generateReading = async () => {
                setLoading(true);
                setStep('reading');
                try {
                    const res = await fetch('/api/oracle', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: `–í–æ–ø—Ä–æ—Å: ${question}. –ö–∞—Ä—Ç—ã: ${selectedCards.map(c => c.name).join(', ')}` })
                    });
                    const data = await res.json();
                    setReading(data.answer);
                } catch (e) { setReading("–°–≤—è–∑—å —Å —ç—Ñ–∏—Ä–æ–º –ø—Ä–µ—Ä–≤–∞–Ω–∞..."); }
                finally { setLoading(false); }
            };

            return (
                <div className="max-w-4xl mx-auto px-6 py-12 flex flex-col items-center">
                    {/* Header */}
                    <header className="text-center mb-16 animate-fade-in">
                        <div className="mb-6 inline-block animate-float">
                             <div className="p-4 rounded-full bg-slate-900 border border-amber-500/30 shadow-glow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" strokeLinecap="round" strokeLinejoin="round" className="text-amber-400"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                             </div>
                        </div>
                        <h1 className="text-5xl font-black font-cinzel tracking-[0.4em] text-transparent bg-clip-text bg-gradient-to-b from-amber-100 to-amber-600 glow-text uppercase">Vox Stellarum</h1>
                    </header>

                    {/* Step 1: Welcome Screen */}
                    {step === 'welcome' && (
                        <div className="w-full max-w-2xl bg-slate-900/40 backdrop-blur-md p-12 rounded-[3rem] border border-amber-900/30 animate-fade-in shadow-2xl text-center">
                            <textarea 
                                value={question}
                                onChange={(e) => setQuestion(e.target.value)}
                                placeholder="–í–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –≤ —Ç–∫–∞–Ω—å –º–∏—Ä–æ–∑–¥–∞–Ω–∏—è..."
                                className="w-full bg-transparent border-b border-amber-900/40 p-4 text-2xl text-amber-100 outline-none h-40 resize-none mb-10 placeholder:text-amber-900/50 text-center font-serif italic"
                            />
                            <button 
                                onClick={() => setStep('drawing')} 
                                className="w-full py-6 bg-amber-600 hover:bg-amber-500 text-slate-950 font-bold rounded-2xl font-cinzel text-xl uppercase tracking-[0.2em] active:scale-95 transition-all shadow-lg shadow-amber-900/20"
                            >
                                –ù–∞—á–∞—Ç—å –†–∏—Ç—É–∞–ª
                            </button>
                        </div>
                    )}

                    {/* Step 2: Drawing Cards */}
                    {step === 'drawing' && (
                        <div className="w-full space-y-12 animate-fade-in flex flex-col items-center">
                            <div className="grid grid-cols-3 gap-6 w-full max-w-lg h-56">
                                {[0, 1, 2].map(i => (
                                    <div key={i} className={`aspect-[2/3] border-2 border-dashed rounded-[2rem] flex items-center justify-center transition-all duration-700 ${selectedCards[i] ? 'border-amber-500 bg-slate-900 shadow-2xl scale-105' : 'border-amber-900/20 bg-slate-950/40'}`}>
                                        {selectedCards[i] ? <span className="text-5xl sm:text-6xl animate-zoom-in drop-shadow-2xl">{selectedCards[i].emoji}</span> : <span className="opacity-10 text-3xl">‚ú¶</span>}
                                    </div>
                                ))}
                            </div>

                            <div className="tarot-deck-grid w-full p-6 bg-slate-900/20 rounded-[2.5rem] border border-amber-900/10 shadow-inner mt-8">
                                {TAROT_DECK.map(card => {
                                    const isSelected = selectedCards.some(c => c.name === card.name);
                                    return (
                                        <button 
                                            key={card.name} 
                                            disabled={selectedCards.length >= 3 || isSelected}
                                            onClick={() => drawCard(card)}
                                            className={`aspect-[2/3] bg-slate-800/80 border border-amber-900/40 rounded-xl transition-all duration-500 ${isSelected ? 'opacity-0 scale-0 pointer-events-none' : 'hover:border-amber-400 hover:-translate-y-2 active:scale-90 shadow-lg'}`}
                                        />
                                    );
                                })}
                            </div>

                            <div className="h-20 w-full flex justify-center items-center">
                                {selectedCards.length === 3 && (
                                    <button onClick={generateReading} className="px-16 py-5 border-2 border-amber-500 text-amber-500 rounded-full font-cinzel text-lg hover:bg-amber-500 hover:text-slate-950 transition-all uppercase tracking-[0.3em] animate-fade-in shadow-[0_0_30px_rgba(245,158,11,0.2)]">
                                        –ü—Ä–æ—á–µ—Å—Ç—å —Å—É–¥—å–±—É
                                    </button>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Step 3: Reading */}
                    {step === 'reading' && (
                        <div className="w-full max-w-2xl bg-slate-900/60 backdrop-blur-xl p-12 rounded-[3rem] border border-amber-500/20 animate-fade-in shadow-2xl">
                            {loading ? (
                                <div className="text-center py-20 space-y-8">
                                    <div className="w-16 h-16 border-t-2 border-amber-500 rounded-full animate-spin mx-auto"></div>
                                    <p className="font-cinzel text-amber-200 animate-pulse uppercase text-sm tracking-[0.4em]">–°—á–∏—Ç—ã–≤–∞–Ω–∏–µ –≠—Ñ–∏—Ä–∞...</p>
                                </div>
                            ) : (
                                <div className="space-y-8 text-center">
                                    <div className="flex justify-center gap-6 mb-8">
                                        {selectedCards.map(c => <span key={c.name} className="text-5xl drop-shadow-2xl p-4 bg-slate-950/50 rounded-2xl border border-amber-900/30">{c.emoji}</span>)}
                                    </div>
                                    <div className="text-amber-100/90 leading-relaxed font-serif text-xl italic whitespace-pre-wrap text-left border-t border-amber-900/20 pt-8">
                                        {reading.replace(/[#*]/g, '')}
                                    </div>
                                    <button onClick={() => {setStep('welcome'); setSelectedCards([]);}} className="mt-12 text-amber-600 font-cinzel text-xs uppercase tracking-[0.3em] hover:text-amber-400 transition-colors flex items-center justify-center gap-2 mx-auto">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
                                        –ù–æ–≤—ã–π –ó–∞–ø—Ä–æ—Å
                                    </button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

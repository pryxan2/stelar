<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOX STELLARUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { cinzel: ['Cinzel', 'serif'], serif: ['Lora', 'serif'] },
                    animation: { 
                        'fade-in': 'fadeIn 0.8s ease-out forwards', 
                        'zoom-in': 'zoomIn 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        zoomIn: { '0%': { opacity: '0', transform: 'scale(0.9)' }, '100%': { opacity: '1', transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body { @apply bg-slate-950 text-amber-100 min-h-screen overflow-x-hidden; }
        }
        .tarot-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 0.5rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TAROT_DECK = [
            { name: "The Fool", emoji: "üÉè" }, { name: "The Magician", emoji: "ü™Ñ" },
            { name: "The High Priestess", emoji: "üåô" }, { name: "The Empress", emoji: "üåø" },
            { name: "The Emperor", emoji: "üëë" }, { name: "The Hierophant", emoji: "‚õ™" },
            { name: "The Lovers", emoji: "‚ù§Ô∏è" }, { name: "The Chariot", emoji: "‚öîÔ∏è" },
            { name: "Strength", emoji: "ü¶Å" }, { name: "The Hermit", emoji: "üèÆ" },
            { name: "Wheel of Fortune", emoji: "üé°" }, { name: "Justice", emoji: "‚öñÔ∏è" },
            { name: "The Hanged Man", emoji: "‚è≥" }, { name: "Death", emoji: "üíÄ" },
            { name: "Temperance", emoji: "üç∑" }, { name: "The Devil", emoji: "üòà" },
            { name: "The Tower", emoji: "‚ö°" }, { name: "The Star", emoji: "‚≠ê" },
            { name: "The Moon", emoji: "üåï" }, { name: "The Sun", emoji: "‚òÄÔ∏è" },
            { name: "Judgement", emoji: "üé∫" }, { name: "The World", emoji: "üåç" }
        ];

        function App() {
            const [step, setStep] = useState('welcome');
            const [selectedCards, setSelectedCards] = useState([]);
            const [reading, setReading] = useState("");
            const [loading, setLoading] = useState(false);
            const [question, setQuestion] = useState("");

            useEffect(() => { lucide.createIcons(); }, [step, loading]);

            const drawCard = (card) => {
                if (selectedCards.length < 3 && !selectedCards.find(c => c.name === card.name)) {
                    setSelectedCards([...selectedCards, card]);
                }
            };

            const generateReading = async () => {
                setLoading(true);
                setStep('reading');
                try {
                    const res = await fetch('/api/oracle', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: `–í–æ–ø—Ä–æ—Å: ${question}. –ö–∞—Ä—Ç—ã: ${selectedCards.map(c => c.name).join(', ')}` })
                    });
                    const data = await res.json();
                    setReading(data.answer);
                } catch (e) {
                    setReading("–ó–≤–µ–∑–¥—ã —Å–∫—Ä—ã–ª–∏—Å—å –∑–∞ —Ç—É—á–∞–º–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="max-w-3xl mx-auto px-6 py-12 relative z-10">
                    <header className="text-center mb-12 animate-fade-in">
                        <i data-lucide="moon" className="w-12 h-12 text-amber-400 mx-auto mb-4 animate-pulse-slow"></i>
                        <h1 className="text-4xl font-black tracking-[0.2em] font-cinzel uppercase bg-clip-text text-transparent bg-gradient-to-b from-amber-100 to-amber-600">Vox Stellarum</h1>
                    </header>

                    {step === 'welcome' && (
                        <div className="bg-slate-900/60 backdrop-blur-xl p-8 rounded-[2rem] border border-amber-900/30 shadow-2xl animate-fade-in">
                            <label className="text-xs uppercase tracking-widest text-amber-500/60 mb-4 block font-cinzel">–í–∞—à –∑–∞–ø—Ä–æ—Å –∫ —ç—Ñ–∏—Ä—É</label>
                            <textarea 
                                value={question} 
                                onChange={(e) => setQuestion(e.target.value)}
                                placeholder="–ß—Ç–æ –≤—ã –∂–µ–ª–∞–µ—Ç–µ —É–∑–Ω–∞—Ç—å?..." 
                                className="w-full bg-transparent border-b border-amber-900/40 p-2 text-xl outline-none h-32 resize-none text-amber-50 focus:border-amber-500 transition-colors"
                            />
                            <button onClick={() => setStep('drawing')} className="w-full mt-8 py-4 bg-amber-600 hover:bg-amber-500 text-slate-950 font-bold rounded-xl uppercase font-cinzel tracking-widest transition-all active:scale-95 shadow-lg shadow-amber-600/20">–ù–∞—á–∞—Ç—å –†–∏—Ç—É–∞–ª</button>
                        </div>
                    )}

                    {step === 'drawing' && (
                        <div className="space-y-12 animate-fade-in">
                            <div className="grid grid-cols-3 gap-4">
                                {[0,1,2].map(i => (
                                    <div key={i} className={`aspect-[2/3] border-2 border-dashed rounded-2xl flex items-center justify-center transition-all duration-500 ${selectedCards[i] ? 'border-amber-500 bg-slate-900 shadow-xl' : 'border-amber-900/20 bg-slate-950/40'}`}>
                                        {selectedCards[i] ? <span className="text-5xl animate-zoom-in drop-shadow-lg">{selectedCards[i].emoji}</span> : <i data-lucide="sparkles" className="opacity-10 w-8 h-8 text-amber-500"></i>}
                                    </div>
                                ))}
                            </div>
                            <div className="tarot-grid py-8 border-t border-amber-900/20">
                                {TAROT_DECK.map((card, idx) => {
                                    const isSelected = selectedCards.find(c => c.name === card.name);
                                    return (
                                        <button 
                                            key={idx} 
                                            disabled={selectedCards.length >= 3 || isSelected}
                                            onClick={() => drawCard(card)}
                                            className={`aspect-[2/3] bg-slate-900 border border-amber-900/40 rounded-lg hover:border-amber-400 transition-all duration-300 transform ${isSelected ? 'opacity-0 scale-50 pointer-events-none' : 'hover:-translate-y-1'}`}
                                        />
                                    );
                                })}
                            </div>
                            {selectedCards.length === 3 && (
                                <button onClick={generateReading} className="w-full py-5 border-2 border-amber-500 text-amber-400 rounded-full font-cinzel tracking-[0.2em] hover:bg-amber-500 hover:text-slate-950 transition-all shadow-glow">–£–ó–ù–ê–¢–¨ –ü–†–ê–í–î–£</button>
                            )}
                        </div>
                    )}

                    {step === 'reading' && (
                        <div className="bg-slate-900/80 backdrop-blur-2xl p-8 rounded-[2.5rem] border border-amber-500/20 shadow-2xl animate-fade-in">
                            {loading ? (
                                <div className="text-center py-20">
                                    <div className="w-16 h-16 border-t-2 border-amber-500 rounded-full animate-spin mx-auto mb-6"></div>
                                    <p className="font-cinzel uppercase tracking-[0.3em] text-amber-200 animate-pulse">–°—á–∏—Ç—ã–≤–∞–Ω–∏–µ –°—É–¥—å–±—ã...</p>
                                </div>
                            ) : (
                                <div className="space-y-6">
                                    <div className="flex justify-center gap-4 mb-8">
                                        {selectedCards.map((c, i) => <span key={i} className="text-4xl p-2 bg-slate-950 rounded-lg border border-amber-900/50">{c.emoji}</span>)}
                                    </div>
                                    <div className="text-amber-100/90 leading-relaxed font-serif text-lg italic whitespace-pre-wrap">
                                        {reading.replace(/[#*]/g, '')}
                                    </div>
                                    <button onClick={() => {setStep('welcome'); setSelectedCards([]); setReading("");}} className="mt-12 flex items-center gap-2 text-amber-600 hover:text-amber-400 mx-auto uppercase text-[10px] font-cinzel tracking-widest transition-colors"><i data-lucide="refresh-cw" className="w-3 h-3"></i> –ù–æ–≤–æ–µ –û–±—Ä–∞—â–µ–Ω–∏–µ</button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
